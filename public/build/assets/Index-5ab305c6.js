import{_ as b}from"./AuthenticatedLayout-c5f9d125.js";import{J as p,c as r,a as d,u as f,w as h,F as _,o as a,X as v,b as s,B as P,C as y,r as u,t as l,f as n,h as k,d as L}from"./app-08ef4c5c.js";import{P as C}from"./Paginate-38d308d0.js";import x from"./Import-49d84040.js";import"./index-ccf33c72.js";import{_ as E}from"./Modal-25de3958.js";/* empty css                                               */import"./_plugin-vue_export-helper-c27b6911.js";import"./InputError-26f6b9cb.js";import"./SecondaryButton-acc591ca.js";import"./SuccessButton-e772e7b8.js";const w={class:"page-wrapper"},D={class:"page-content"},V={class:"page-breadcrumb d-sm-flex align-items-center mb-3"},N=s("div",{class:"breadcrumb-title pe-3"},"Excel Import",-1),$=s("div",{class:"ps-3"},[s("nav",{"aria-label":"breadcrumb"},[s("ol",{class:"breadcrumb mb-0 p-0"},[s("li",{class:"breadcrumb-item"},[s("a",{href:"javascript:;"},[s("i",{class:"bx bx-home-alt"})])]),s("li",{class:"breadcrumb-item active text-capitalize","aria-current":"page"},"List ")])])],-1),B=s("div",{class:"ms-auto"},null,-1),M={class:"ms-auto"},A={class:"card"},S=s("div",{class:"card-header"},[s("h5",{class:"text-center mt-1"})],-1),j={class:"card-body"},I={class:"table-responsive"},T={class:"table table-bordered table-sm text-uppercase",style:{"font-size":"12px"}},z=s("thead",{class:"table-light"},[s("tr",null,[s("th",{class:"px-2"},"Sr #"),s("th",{class:"px-2"},"ID"),s("th",{class:"px-2"},"No of Policies"),s("th",{class:"px-2"},"Found Discrepancies"),s("th",{class:"px-2"},"Time/Date"),s("th",{class:"px-2"},"Action")])],-1),F={class:"px-2"},O={class:"px-2"},R={class:"px-2"},J={class:"px-2"},W={class:"px-2"},X={class:"px-2"},q={class:"badge bg-success"},G=["onClick"],H={class:"card-body"},K={class:"float-right"},Q={key:0,class:"mt-4"},U={class:"pl-4"},Y={class:"row p-4"},Z={class:"col-md-4"},ss={class:"card"},es={class:"card-body"},ts={class:"card-title"},os={class:"col-md-4"},ls={class:"card"},rs={class:"card-body"},as={class:"card-title"},is={class:"text-danger"},cs={class:"col-md-4"},ds={class:"card"},ns={class:"card-body"},_s={class:"card-title"},hs={class:"text-success"},us={class:"table-responsive p-4"},ps={class:"table table-bordered table-sm"},ms=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Policy No"),s("th",null,"Error Message"),s("th",null,"Discrepancies")])],-1),gs=["onClick"],bs={key:1},fs={class:"pagination-controls p-2 d-flex justify-content-end"},vs=["disabled"],Ps=["disabled"],ys={class:"p-6"},ks=s("h2",{class:"text-lg font-medium text-gray-900"},"Policy Discrepancies",-1),Ls=s("p",{class:"mt-1 text-sm text-gray-600"}," The following discrepancies were found in the selected log: ",-1),Cs=s("hr",null,null,-1),xs={class:"mt-4"},Es={class:"mt-6 flex justify-end"},ws={props:["error_logs","import_completed_count"],data(){return{selectedLog:null,modalVisible:!1,modalErrors:[],currentPage:1,perPage:5}},computed:{totalPolicies(){return this.error_logs.data.reduce((t,e)=>t+e.total_records,0)},policiesWithDiscrepancies(){return this.error_logs.data.reduce((t,e)=>t+e.failed_records,0)},validPolicies(){return this.totalPolicies-this.policiesWithDiscrepancies},paginatedErrors(){if(!this.selectedLog||!this.selectedLog.errors)return[];const t=(this.currentPage-1)*this.perPage,e=t+this.perPage;return this.selectedLog.errors.slice(t,e)},totalPages(){return!this.selectedLog||!this.selectedLog.errors?1:Math.ceil(this.selectedLog.errors.length/this.perPage)}},methods:{selectLog(t){t.errors.forEach(e=>{if(typeof e.multiple_errors=="string")try{e.multiple_errors=JSON.parse(e.multiple_errors)}catch(i){console.error("Error parsing multiple_errors:",i),e.multiple_errors=[]}}),this.selectedLog=t,this.currentPage=1},showMultipleErrors(t){t&&Array.isArray(t)?this.modalErrors=t:this.modalErrors=[],this.modalVisible=!0},closeModal(){this.modalVisible=!1,this.modalErrors=[]},changePage(t){this.currentPage=t}}},zs=Object.assign(ws,{__name:"Index",props:{error_logs:Array,import_completed_count:Object},setup(t){return p().props.import_completed_count,p().props.error_logs.data.length,(e,i)=>{const m=L("SecondaryButton");return a(),r(_,null,[d(f(v),{title:"Sales Report"}),d(b,null,{default:h(()=>[s("div",w,[s("div",D,[s("div",V,[N,$,B,s("div",M,[d(x,P(y(e.$props)),null,16)])]),s("div",A,[S,s("div",j,[s("div",I,[s("table",T,[z,s("tbody",null,[(a(!0),r(_,null,u(t.error_logs.data,(o,c)=>(a(),r("tr",null,[s("td",F,l((t.error_logs.current_page-1)*t.error_logs.per_page+c+1),1),s("td",O,l(o.id),1),s("td",R,l(o.total_records),1),s("td",J,l(o.failed_records),1),s("td",W,l(o.created_at),1),s("td",X,[s("span",q,l(o.total_records-o.failed_records)+" / "+l(o.total_records)+" uploaded successfully",1),n(),s("span",{class:"bx bx-info-circle cursor-pointer",onClick:g=>e.selectLog(o)},null,8,G)])]))),256))])])])]),s("div",H,[s("div",K,[d(C,{links:t.error_logs.links},null,8,["links"])])]),e.selectedLog?(a(),r("div",Q,[s("h5",U,"Validation Results for Batch ID: "+l(e.selectedLog.id),1),s("div",Y,[s("div",Z,[s("div",ss,[s("div",es,[s("h5",ts,"Total Policies: "+l(e.selectedLog.total_records),1)])])]),s("div",os,[s("div",ls,[s("div",rs,[s("h5",as,[n("Policies with Discrepancies: "),s("span",is,l(e.selectedLog.errors.length),1)])])])]),s("div",cs,[s("div",ds,[s("div",ns,[s("h5",_s,[n("Valid Policies: "),s("span",hs,l(e.selectedLog.total_records-e.selectedLog.errors.length),1)])])])])]),s("div",us,[s("table",ps,[ms,s("tbody",null,[(a(!0),r(_,null,u(e.paginatedErrors,(o,c)=>(a(),r("tr",{key:c},[s("td",null,l((e.currentPage-1)*e.perPage+c+1),1),s("td",null,l(o.policy_no),1),s("td",null,l(o.error_message),1),s("td",null,[o.multiple_errors&&Array.isArray(o.multiple_errors)?(a(),r("button",{key:0,class:"btn btn-link p-0",onClick:g=>e.showMultipleErrors(o.multiple_errors)},l(o.multiple_errors.length),9,gs)):(a(),r("span",bs,"0"))])]))),128))])])]),s("div",fs,[s("button",{class:"btn btn-sm btn-secondary me-2",disabled:e.currentPage===1,onClick:i[0]||(i[0]=o=>e.changePage(e.currentPage-1))}," Previous ",8,vs),s("span",null,"Page "+l(e.currentPage)+" of "+l(e.totalPages),1),s("button",{class:"btn btn-sm btn-secondary ms-2",disabled:e.currentPage===e.totalPages,onClick:i[1]||(i[1]=o=>e.changePage(e.currentPage+1))}," Next ",8,Ps)])])):k("",!0)])])]),d(E,{show:e.modalVisible,onClose:e.closeModal},{default:h(()=>[s("div",ys,[ks,Ls,Cs,s("div",xs,[s("ul",null,[(a(!0),r(_,null,u(e.modalErrors,(o,c)=>(a(),r("li",{key:c,class:"text-sm text-gray-700"},[s("strong",null,l(o.type)+":",1),n(" "+l(o.message),1)]))),128))])]),s("div",Es,[d(m,{onClick:e.closeModal},{default:h(()=>[n(" Close ")]),_:1},8,["onClick"])])])]),_:1},8,["show","onClose"])]),_:1})],64)}}});export{zs as default};
