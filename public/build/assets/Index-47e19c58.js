import{_ as b}from"./AuthenticatedLayout-9067ee61.js";import{Q as m,r as f,o as a,c as i,a as n,u as v,w as p,F as u,Z as y,b as s,y as P,z as k,d as _,t as r,f as c,h as L}from"./app-1f90dc38.js";import{P as C}from"./Paginate-082b162c.js";import x from"./Import-d3a76de0.js";import"./index-5f947eec.js";import{_ as E}from"./SecondaryButton-71e979f9.js";/* empty css                                               */import"./_plugin-vue_export-helper-c27b6911.js";import"./InputError-d1d4538c.js";import"./SuccessButton-df77c511.js";const w={class:"page-wrapper"},D={class:"page-content"},V={class:"page-breadcrumb d-sm-flex align-items-center mb-3"},N={class:"ms-auto"},$={class:"card"},M={class:"card-body"},A={class:"table-responsive"},B={class:"table table-bordered table-sm text-uppercase",style:{"font-size":"12px"}},S={class:"px-2"},j={class:"px-2"},z={class:"px-2"},I={class:"px-2"},T={class:"px-2"},F={class:"px-2"},O={class:"badge bg-success"},R=["onClick"],W={class:"card-body"},J={class:"float-right"},Q={key:0,class:"mt-4"},Z={class:"pl-4"},q={class:"row p-4"},G={class:"col-md-4"},H={class:"card"},K={class:"card-body"},U={class:"card-title"},X={class:"col-md-4"},Y={class:"card"},ss={class:"card-body"},es={class:"card-title"},ts={class:"text-danger"},os={class:"col-md-4"},ls={class:"card"},rs={class:"card-body"},as={class:"card-title"},is={class:"text-success"},ds={class:"table-responsive p-4"},ns={class:"table table-bordered table-sm"},cs=["onClick"],us={key:1},ps={class:"pagination-controls p-2 d-flex justify-content-end"},_s=["disabled"],ms=["disabled"],hs={class:"p-6"},gs={class:"mt-4"},bs={class:"mt-6 flex justify-end"},fs={props:["error_logs","import_completed_count"],data(){return{selectedLog:null,modalVisible:!1,modalErrors:[],currentPage:1,perPage:5}},computed:{totalPolicies(){return this.error_logs.data.reduce((o,e)=>o+e.total_records,0)},policiesWithDiscrepancies(){return this.error_logs.data.reduce((o,e)=>o+e.failed_records,0)},validPolicies(){return this.totalPolicies-this.policiesWithDiscrepancies},paginatedErrors(){if(!this.selectedLog||!this.selectedLog.errors)return[];const o=(this.currentPage-1)*this.perPage,e=o+this.perPage;return this.selectedLog.errors.slice(o,e)},totalPages(){return!this.selectedLog||!this.selectedLog.errors?1:Math.ceil(this.selectedLog.errors.length/this.perPage)}},methods:{selectLog(o){o.errors.forEach(e=>{if(typeof e.multiple_errors=="string")try{e.multiple_errors=JSON.parse(e.multiple_errors)}catch(t){console.error("Error parsing multiple_errors:",t),e.multiple_errors=[]}}),this.selectedLog=o,this.currentPage=1},showMultipleErrors(o){o&&Array.isArray(o)?this.modalErrors=o:this.modalErrors=[],this.modalVisible=!0},closeModal(){this.modalVisible=!1,this.modalErrors=[]},changePage(o){this.currentPage=o}}},Vs=Object.assign(fs,{__name:"Index",props:{error_logs:Array,import_completed_count:Object},setup(o){return m().props.import_completed_count,m().props.error_logs.data.length,(e,t)=>{const h=f("SecondaryButton");return a(),i(u,null,[n(v(y),{title:"Sales Report"}),n(b,null,{default:p(()=>[s("div",w,[s("div",D,[s("div",V,[t[2]||(t[2]=s("div",{class:"breadcrumb-title pe-3"},"Excel Import",-1)),t[3]||(t[3]=s("div",{class:"ps-3"},[s("nav",{"aria-label":"breadcrumb"},[s("ol",{class:"breadcrumb mb-0 p-0"},[s("li",{class:"breadcrumb-item"},[s("a",{href:"javascript:;"},[s("i",{class:"bx bx-home-alt"})])]),s("li",{class:"breadcrumb-item active text-capitalize","aria-current":"page"},"List ")])])],-1)),t[4]||(t[4]=s("div",{class:"ms-auto"},null,-1)),s("div",N,[n(x,P(k(e.$props)),null,16)])]),s("div",$,[t[10]||(t[10]=s("div",{class:"card-header"},[s("h5",{class:"text-center mt-1"})],-1)),s("div",M,[s("div",A,[s("table",B,[t[6]||(t[6]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{class:"px-2"},"Sr #"),s("th",{class:"px-2"},"ID"),s("th",{class:"px-2"},"No of Policies"),s("th",{class:"px-2"},"Found Discrepancies"),s("th",{class:"px-2"},"Time/Date"),s("th",{class:"px-2"},"Action")])],-1)),s("tbody",null,[(a(!0),i(u,null,_(o.error_logs.data,(l,d)=>(a(),i("tr",null,[s("td",S,r((o.error_logs.current_page-1)*o.error_logs.per_page+d+1),1),s("td",j,r(l.id),1),s("td",z,r(l.total_records),1),s("td",I,r(l.failed_records),1),s("td",T,r(l.created_at),1),s("td",F,[s("span",O,r(l.total_records-l.failed_records)+" / "+r(l.total_records)+" uploaded successfully",1),t[5]||(t[5]=c()),s("span",{class:"bx bx-info-circle cursor-pointer",onClick:g=>e.selectLog(l)},null,8,R)])]))),256))])])])]),s("div",W,[s("div",J,[n(C,{links:o.error_logs.links},null,8,["links"])])]),e.selectedLog?(a(),i("div",Q,[s("h5",Z,"Validation Results for Batch ID: "+r(e.selectedLog.id),1),s("div",q,[s("div",G,[s("div",H,[s("div",K,[s("h5",U,"Total Policies: "+r(e.selectedLog.total_records),1)])])]),s("div",X,[s("div",Y,[s("div",ss,[s("h5",es,[t[7]||(t[7]=c("Policies with Discrepancies: ")),s("span",ts,r(e.selectedLog.errors.length),1)])])])]),s("div",os,[s("div",ls,[s("div",rs,[s("h5",as,[t[8]||(t[8]=c("Valid Policies: ")),s("span",is,r(e.selectedLog.total_records-e.selectedLog.errors.length),1)])])])])]),s("div",ds,[s("table",ns,[t[9]||(t[9]=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Policy No"),s("th",null,"Error Message"),s("th",null,"Discrepancies")])],-1)),s("tbody",null,[(a(!0),i(u,null,_(e.paginatedErrors,(l,d)=>(a(),i("tr",{key:d},[s("td",null,r((e.currentPage-1)*e.perPage+d+1),1),s("td",null,r(l.policy_no),1),s("td",null,r(l.error_message),1),s("td",null,[l.multiple_errors&&Array.isArray(l.multiple_errors)?(a(),i("button",{key:0,class:"btn btn-link p-0",onClick:g=>e.showMultipleErrors(l.multiple_errors)},r(l.multiple_errors.length),9,cs)):(a(),i("span",us,"0"))])]))),128))])])]),s("div",ps,[s("button",{class:"btn btn-sm btn-secondary me-2",disabled:e.currentPage===1,onClick:t[0]||(t[0]=l=>e.changePage(e.currentPage-1))}," Previous ",8,_s),s("span",null,"Page "+r(e.currentPage)+" of "+r(e.totalPages),1),s("button",{class:"btn btn-sm btn-secondary ms-2",disabled:e.currentPage===e.totalPages,onClick:t[1]||(t[1]=l=>e.changePage(e.currentPage+1))}," Next ",8,ms)])])):L("",!0)])])]),n(E,{show:e.modalVisible,onClose:e.closeModal},{default:p(()=>[s("div",hs,[t[12]||(t[12]=s("h2",{class:"text-lg font-medium text-gray-900"},"Policy Discrepancies",-1)),t[13]||(t[13]=s("p",{class:"mt-1 text-sm text-gray-600"}," The following discrepancies were found in the selected log: ",-1)),t[14]||(t[14]=s("hr",null,null,-1)),s("div",gs,[s("ul",null,[(a(!0),i(u,null,_(e.modalErrors,(l,d)=>(a(),i("li",{key:d,class:"text-sm text-gray-700"},[s("strong",null,r(l.type)+":",1),c(" "+r(l.message),1)]))),128))])]),s("div",bs,[n(h,{onClick:e.closeModal},{default:p(()=>t[11]||(t[11]=[c(" Close ")])),_:1},8,["onClick"])])])]),_:1},8,["show","onClose"])]),_:1})],64)}}});export{Vs as default};
